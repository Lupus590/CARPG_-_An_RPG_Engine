if (self.CavalryLogger) { CavalryLogger.start_js(["LlbV6"]); }

__d('NotificationCounter',['Arbiter','CrossWindowEventEmitter','DocumentTitle','JSLogger','MessengerEnvironment'],(function a(b,c,d,e,f,g){var h=new (c('CrossWindowEventEmitter'))('JewelBase'),i={messages:0,notifications:0,requests:0},j={init:function k(){c('Arbiter').subscribe('update_title',this._handleUpdate.bind(this));c('Arbiter').subscribe('jewel/count-updated',this._handleCountUpdate.bind(this));h.addListener('count-updated',function(l){this._handleCountUpdate('',l)}.bind(this))},getCount:function k(){var l=0;for(var m in i){var n=Number(i[m]);if(typeof i[m]=='string'&&isNaN(n))return i[m];if(isNaN(n)||n<0){c('JSLogger').create('jewels').error('bad_count',{jewel:m,count:i[m]});continue}l+=n}return l},updateTitle:function k(){if(c('MessengerEnvironment').messengerui)return;var l=this.getCount(),m=c('DocumentTitle').get();m=l?'('+l+') '+m:m;c('DocumentTitle').set(m,true)},_handleCountUpdate:function k(l,m){i[m.jewel]=m.count;this.updateTitle()},_handleUpdate:function k(l,m){this.updateTitle()}};f.exports=j}),null);
__d("XNotificationsSyncController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/notifications\/sync\/",{lastSync:{type:"Int",required:true}})}),null);
__d('NotificationSync',['Arbiter','AsyncRequest','ChannelConstants','JSLogger','NotificationConstants','NotificationUpdates','XNotificationsSyncController'],(function a(b,c,d,e,f,g){var h=c('JSLogger').create('notifications'),i='channel_reload',j=0;function k(p){var q=c('NotificationUpdates').getserverTime()?c('NotificationUpdates').getserverTime():j,r=c('XNotificationsSyncController').getURIBuilder().setInt('lastSync',q).getURI();p.setHandler(l).setOption('suppressErrorAlerts',true).setErrorHandler(m).setMethod('GET').setReadOnly(true).setURI(r).setAllowCrossPageTransition(true)}function l(p){var q=p.getPayload();if(q.syncPayload)c('NotificationUpdates').handleUpdate(c('NotificationConstants').PayloadSourceType.SYNC,q.syncPayload);}function m(p){}function n(){var p=new (c('AsyncRequest'))();p.setIsBackgroundRequest(true);k(p);p.send();h.bump(i)}var o={setup:function p(q){j=q;c('Arbiter').subscribe(c('ChannelConstants').ON_INVALID_HISTORY,n)}};f.exports=o}),null);
__d('NotificationJewelController',['Arbiter','Bootloader','Event','EventProfiler','FunnelLogger','NotificationConstants','NotificationCounter','NotificationJewelFunnelLoggingConstants','NotificationSeenState','NotificationStore','NotificationSync','NotificationUpdates','createObjectFrom','curry','isInFocusMode'],(function a(b,c,d,e,f,g){var h=c('NotificationConstants').PayloadSourceType,i=c('NotificationJewelFunnelLoggingConstants').FUNNEL_LOGGING_NAME,j=c('NotificationJewelFunnelLoggingConstants').FUNNEL_LOGGING_EVENT,k=0,l=false;function m(o){var p=c('isInFocusMode')(),q=c('NotificationSeenState').getUnseenCount();c('Arbiter').inform('jewel/count-updated',{jewel:o,count:p?0:q,animation:!p&&l&&q>0?'heart':'none'},c('Arbiter').BEHAVIOR_STATE)}function n(o,p){'use strict';var q=p.badgeAnimationData,r=p.endPoint,s=p.list,t=p.startTime,u=p.unseenNotifs;if(r)c('NotificationStore').registerEndpoint({endpointURI:r});c('NotificationCounter').init();var v=false,w=null,x=c('Event').listen(o.getRoot(),'mouseover',function(){if(!v){v=true;w=c('EventProfiler').notifyRunningEagerInteraction(o.getRoot(),'click')}c('FunnelLogger').startFunnel(i);x&&x.remove();x=null;s.open();c('FunnelLogger').appendAction(i,j.MOUSE_OVER_ON_JEWEL)}),y=false,z=o.subscribe('opened',function(){if(!y){y=true;c('EventProfiler').tagCurrentActiveInteractionsAs('FirstNotificationJewelOpen')}if(w)w();z&&z.unsubscribe();z=null;s.open()}),aa=s.pause.bind(s);o.subscribe('opened',function(){setTimeout(aa,0);m(o.name);c('Bootloader').loadModules(["NotificationVPVs"],function(ba){return ba.clearImpressions()},'NotificationJewelController');c('Arbiter').inform('notificationJewel/opened')});o.subscribe('closed',function(){s.unpause();m(o.name);c('Arbiter').inform('notificationJewel/closed')});c('NotificationUpdates').subscribe('seen-state-updated',c('curry')(m,o.name));if(q){if(q.logWithQEUniverse)c('Bootloader').loadModules(["QE2Logger"],function(ba){return ba.logExposureForUser(q.logWithQEUniverse)},'NotificationJewelController');if(q.injectWithAnimation)c('Bootloader').loadModules(["RelationshipDelightsBadge"],function(ba){return ba.inject(o,q.injectWithAnimation)},'NotificationJewelController');c('Bootloader').loadModules(["RelationshipDelightUtils"],function(ba){c('NotificationUpdates').subscribe('update-notifications',function(ca,da){var ea=da.nodes,fa=da.payloadsource,ga=ea&&ea.length?ea.filter(ba.shouldHeartBadge):null;if(ga&&ga.length){l=true;if(q.injectWithAnimation)if(fa===h.INITIAL_LOAD||fa===h.INITIAL_SEND)ba.logBadgeAnimation(ga[0].alert_id);}else l=false;});if(q.logWithAlertID)ba.logBadgeAnimation(q.logWithAlertID);},'NotificationJewelController')}c('NotificationUpdates').handleUpdate(h.INITIAL_LOAD,{seenState:c('createObjectFrom')(u,k)});c('NotificationSync').setup(t);m(o.name);c('NotificationUpdates').setEndPoint(r)}f.exports=n}),null);